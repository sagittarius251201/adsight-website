<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdSight - Client Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F9FAFB; color: #111827; }
        .dashboard-chart { position: relative; height: 300px; width: 100%; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes spin { to { transform: rotate(360deg); } }
        .fade-in { animation: fadeIn 0.5s ease-in-out forwards; }
        .loader {
            border: 4px solid #e5e7eb; border-top: 4px solid #4f46e5;
            border-radius: 50%; width: 48px; height: 48px; animation: spin 1s linear infinite;
        }
        /* Styles for Content Studio */
        .geo-studio-container { --bg-primary: #F9FAFB; --bg-secondary: #FFFFFF; --border-color: #E5E7EB; --text-primary: #111827; --text-secondary: #6B7280; --accent-primary: #4F46E5; --accent-hover: #4338CA; background-color: var(--bg-primary); color: var(--text-primary); }
        .geo-card { background-color: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 0.75rem; padding: 1rem; }
        .geo-btn-primary { background-color: var(--accent-primary); color: white; font-weight: 600; padding: 0.5rem 1rem; border-radius: 0.5rem; transition: background-color 0.2s; border: none; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; font-size: 0.875rem; }
        .geo-btn-primary:hover { background-color: var(--accent-hover); }
        .geo-btn-primary:disabled { background-color: #A5B4FC; cursor: not-allowed; }
        .geo-text-input, .geo-textarea { background-color: #F3F4F6; border: 1px solid #D1D5DB; color: var(--text-primary); border-radius: 0.5rem; padding: 0.5rem 0.75rem; font-size: 0.875rem; width: 100%;}
        .geo-interactive-editor { background-color: #F3F4F6; border: 1px solid #D1D5DB; border-radius: 0.5rem; padding: 1rem; height: 100%; color: #111827; outline: none; white-space: pre-wrap; }
        .node { stroke: #fff; stroke-width: 1.5px; }
        .link { stroke: #999; stroke-opacity: 0.6; }
        .node-text { fill: #374151; font-size: 10px; pointer-events: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback, useMemo } = React;
        
        // --- UI COMPONENTS ---
        const Icon = ({ name, className }) => {
            const icons = {
                package: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12.0001 2.00002C6.47727 2.00002 2.00006 6.47723 2.00006 12C2.00006 17.5228 6.47727 22 12.0001 22C17.5229 22 22.0001 17.5228 22.0001 12C22.0001 6.47723 17.5229 2.00002 12.0001 2.00002ZM12.0001 4.00002C16.4184 4.00002 20.0001 7.58172 20.0001 12C20.0001 16.4183 16.4184 20 12.0001 20C7.58181 20 4.00006 16.4183 4.00006 12C4.00006 7.58172 7.58181 4.00002 12.0001 4.00002Z" /></svg>,
                barChart: <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" x2="12" y1="20" y2="10" /><line x1="18" y1="20" x2="18" y2="4" /><line x1="6" y1="20" x2="6" y2="16" /></svg>,
                users: <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M22 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /></svg>,
                search: <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8" /><path d="m21 21-4.3-4.3" /></svg>,
                trendingUp: <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
                pieChart: <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21.21 15.89A10 10 0 1 1 8 2.83" /><path d="M22 12A10 10 0 0 0 12 2v10z" /></svg>,
                sparkles: <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.9 5.8a2 2 0 0 1-1.2 1.2L3 12l5.8 1.9a2 2 0 0 1 1.2 1.2L12 21l1.9-5.8a2 2 0 0 1 1.2-1.2L21 12l-5.8-1.9a2 2 0 0 1-1.2-1.2Z"/></svg>,
                fingerprint: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 10v4"/><path d="M12 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z"/><path d="M12 2a4.5 4.5 0 0 0-4.5 4.5 4.5 4.5 0 0 0 1.2 3.1L9 10.8V10c0-1.1.9-2 2-2h.5a2.5 2.5 0 0 1 2.5 2.5V10h.5a2 2 0 0 1 2 2v1.8l.2.8a4.5 4.5 0 0 0 1.3-3.1A4.5 4.5 0 0 0 12 2Z"/><path d="M4.1 11.2a4.5 4.5 0 0 0-2.6 3.3 4.5 4.5 0 0 0 4.5 4.5h7c.8 0 1.5-.2 2.1-.6"/><path d="M19.9 11.2a4.5 4.5 0 0 1 2.6 3.3 4.5 4.5 0 0 1-4.5 4.5h-7a4.5 4.5 0 0 1-4.2-2.9"/></svg>,
                edit: <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
                settings: <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
            };
            return <div className={`w-6 h-6 ${className}`}>{icons[name]}</div>;
        };

        const ChartComponent = ({ type, data, options, className }) => { /* ... */ };
        const KnowledgeGraph = ({ data }) => { /* ... */ };
        
        // --- DYNAMIC GEO COMPONENTS ---
        const KnowledgePanelSimulator = ({ data }) => { /* ... */ };
        const AiCrawlerAudit = ({ data }) => { /* ... */ };
        const BrandSerpAnalysis = ({ data }) => { /* ... */ };
        const ContentStudio = ({ apiKey, callGeminiApi }) => { /* ... */ };

        // --- DASHBOARD AND LOGIN PAGES ---
        const LoginPage = ({ setRoute }) => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');

            const handleLogin = (e) => {
                e.preventDefault();
                setError('');
                if (email === 'client@adsight.com' && password === 'password123') {
                    setRoute('clientDashboard');
                } else {
                    setError('Invalid email or password.');
                }
            };

            return (
                <div className="flex min-h-screen flex-col justify-center bg-gray-100 py-12 fade-in">
                    <div className="w-full max-w-md p-8 space-y-6 bg-white rounded-xl shadow-2xl mx-auto">
                        <div className="text-center">
                             <a href="./index.html" className="inline-block text-indigo-600"><Icon name="package" /></a>
                            <h1 className="text-3xl font-bold mt-2">Client Portal Login</h1>
                            <p className="text-gray-500 mt-2">Sign in to access your AdSight dashboard.</p>
                        </div>
                        {error && <div className="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md"><p>{error}</p></div>}
                        <form onSubmit={handleLogin} className="space-y-6">
                            <div>
                                <label htmlFor="email" className="text-sm font-bold text-gray-600 block">Email</label>
                                <input id="email" type="email" value={email} onChange={e => setEmail(e.target.value)} className="w-full p-3 mt-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="e.g., client@adsight.com" required />
                            </div>
                            <div>
                                <label htmlFor="password" className="text-sm font-bold text-gray-600 block">Password</label>
                                <input id="password" type="password" value={password} onChange={e => setPassword(e.target.value)} className="w-full p-3 mt-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="password123" required />
                            </div>
                            <button type="submit" className="w-full py-3 px-4 bg-indigo-600 hover:bg-indigo-700 rounded-md text-white text-lg font-semibold transition-colors">Sign In</button>
                        </form>
                    </div>
                </div>
            );
        };

        const ClientDashboard = ({ setRoute }) => {
            const [apiKey, setApiKey] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState('');
            const [analysisData, setAnalysisData] = useState(null);
            const [activeTab, setActiveTab] = useState('overview');
            const [brandGeoSubTab, setBrandGeoSubTab] = useState('entity');
            const [websiteUrl, setWebsiteUrl] = useState('');
            const [isApiModalOpen, setIsApiModalOpen] = useState(false);

            useEffect(() => {
                const savedKey = localStorage.getItem('geminiApiKey_adsight');
                if(savedKey) setApiKey(savedKey);
            }, []);

            const callGeminiApi = useCallback(async (currentApiKey, prompt, isJson = true) => { /* ... */ }, []);
            const handleAnalyze = async (url, key) => { /* ... */ };
            
            const StatCard = ({ icon, label, value, change }) => (
                <div className="bg-white p-6 rounded-xl shadow-sm border">
                    <div className="flex justify-between items-start"><h3 className="text-sm font-medium text-gray-500">{label}</h3><Icon name={icon} className="text-gray-400"/></div>
                    <p className="text-3xl font-bold text-gray-800 mt-2">{value}</p>
                    {change && <p className={`text-sm mt-1 ${change.startsWith('+') ? 'text-green-600' : 'text-red-600'}`}>{change}</p>}
                </div>
            );
            
            const AnalysisInputScreen = () => (
                <div className="text-center max-w-lg mx-auto pt-20">
                    <h1 className="text-3xl font-bold text-gray-800">Brand GEO Analysis</h1>
                    <p className="mt-4 text-gray-600">Enter a website URL to run a complete analysis of the brand's digital entity.</p>
                     <div className="mt-8 space-y-4">
                        <input type="url" value={websiteUrl} onChange={e => setWebsiteUrl(e.target.value)} placeholder="https://www.yourwebsite.com" className="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                     </div>
                    <button onClick={() => { handleAnalyze(websiteUrl, apiKey); }} disabled={isLoading || !apiKey} className="mt-6 w-full bg-indigo-600 text-white font-bold py-3 rounded-lg hover:bg-indigo-700 transition-colors text-lg flex justify-center items-center disabled:bg-indigo-400" title={!apiKey ? "Please set your API Key in Settings first" : ""}>
                        {isLoading ? <div className="loader !w-6 !h-6 !border-t-white !border-4"></div> : "Analyze Website"}
                    </button>
                    {!apiKey && <p className="text-sm text-yellow-600 mt-3">Please set your Gemini API Key in the top-right settings before running an analysis.</p>}
                    {error && <p className="text-red-600 text-sm mt-4">{error}</p>}
                </div>
            );

            const BrandGeoDashboard = () => { /* ... */ };
            const OverviewDashboard = () => { /* ... */ };
            const ApiKeyModal = () => { /* ... */ };

            const renderContent = () => {
                switch(activeTab) {
                    case 'overview':
                        return <OverviewDashboard />;
                    case 'brandGeo':
                        return analysisData ? <BrandGeoDashboard /> : <AnalysisInputScreen />;
                    case 'contentStudio':
                        return <ContentStudio apiKey={apiKey} callGeminiApi={callGeminiApi} />;
                    default:
                        return <OverviewDashboard />;
                }
            };

            return (
                <div className="flex bg-gray-100 min-h-screen">
                    {isApiModalOpen && <ApiKeyModal />}
                    <aside className="w-64 bg-white p-6 border-r border-gray-200 flex flex-col">
                        <div className="flex items-center gap-2 text-2xl font-bold text-gray-800">
                             <a href="./index.html" className="flex items-center gap-2"><Icon name="package" /> AdSight</a>
                        </div>
                        <nav className="mt-10 space-y-2">
                             <a href="#" onClick={() => setActiveTab('overview')} className={`flex items-center gap-3 px-4 py-2 font-semibold rounded-lg ${activeTab === 'overview' ? 'bg-indigo-50 text-indigo-700' : 'text-gray-600 hover:bg-gray-100'}`}><Icon name="barChart" /> Overview</a>
                             <a href="#" onClick={() => setActiveTab('brandGeo')} className={`flex items-center gap-3 px-4 py-2 font-semibold rounded-lg ${activeTab === 'brandGeo' ? 'bg-indigo-50 text-indigo-700' : 'text-gray-600 hover:bg-gray-100'}`}><Icon name="search" /> Brand GEO</a>
                             <a href="#" onClick={() => setActiveTab('contentStudio')} className={`flex items-center gap-3 px-4 py-2 font-semibold rounded-lg ${activeTab === 'contentStudio' ? 'bg-indigo-50 text-indigo-700' : 'text-gray-600 hover:bg-gray-100'}`}><Icon name="edit" /> Content Studio</a>
                        </nav>
                         <div className="mt-auto p-4 bg-indigo-50 rounded-lg text-center">
                            <h4 className="font-bold text-indigo-800">Need Help?</h4>
                            <p className="text-sm text-indigo-700 mt-1">Contact your dedicated account manager.</p>
                            <button className="mt-3 w-full bg-indigo-600 text-white text-sm font-bold py-2 rounded-lg hover:bg-indigo-700">Contact Support</button>
                        </div>
                    </aside>
                    <main className="flex-1 p-8">
                         <div className="flex justify-end mb-4">
                            <button onClick={() => setIsApiModalOpen(true)} className="p-2 rounded-full hover:bg-gray-200" title="API Key Settings">
                                <Icon name="settings" className="text-gray-600" />
                            </button>
                        </div>
                        {renderContent()}
                    </main>
                </div>
            );
        };
        
        // --- App Router for Dashboard ---
        const App = () => {
            const [route, setRoute] = useState('login');
            
            if (route === 'login') return <LoginPage setRoute={setRoute} />;
            if (route === 'clientDashboard') return <ClientDashboard setRoute={setRoute} />;
            return <LoginPage setRoute={setRoute} />; // Default to login for the dashboard app
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
